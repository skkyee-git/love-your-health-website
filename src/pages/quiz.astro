---
import BaseLayout from '../layouts/BaseLayout.astro';

const questions = [
  {
    id: 1,
    question: 'How would you describe your energy levels most days?',
    options: [
      { text: 'Good — I have steady energy throughout the day', points: { fatigue: 0, thyroid: 0 } },
      { text: 'I crash in the afternoon and need caffeine to get through', points: { fatigue: 2, thyroid: 1 } },
      { text: 'I wake up exhausted no matter how much I sleep', points: { fatigue: 3, thyroid: 2 } },
      { text: 'My energy is unpredictable — good some days, terrible others', points: { fatigue: 2, hormones: 1 } },
    ],
  },
  {
    id: 2,
    question: 'How is your digestion?',
    options: [
      { text: 'No major complaints', points: { gut: 0 } },
      { text: 'Occasional bloating or discomfort after meals', points: { gut: 1 } },
      { text: 'Frequent bloating, gas, constipation, or diarrhea', points: { gut: 3, autoimmune: 1 } },
      { text: 'I react to many foods and have had to restrict my diet', points: { gut: 3, autoimmune: 2 } },
    ],
  },
  {
    id: 3,
    question: 'Have you had trouble losing weight despite diet and exercise?',
    options: [
      { text: 'No — my weight responds normally to lifestyle changes', points: { weight: 0 } },
      { text: 'It is harder than it used to be', points: { weight: 1, hormones: 1 } },
      { text: 'Yes — the scale barely moves no matter what I do', points: { weight: 3, thyroid: 2 } },
      { text: 'I gain weight easily, especially around my midsection', points: { weight: 2, hormones: 2 } },
    ],
  },
  {
    id: 4,
    question: 'How would you rate your mood and mental clarity?',
    options: [
      { text: 'Generally good — clear-headed and emotionally balanced', points: { anxiety: 0 } },
      { text: 'I have more brain fog or forgetfulness than I used to', points: { anxiety: 1, thyroid: 1 } },
      { text: 'I frequently feel anxious, overwhelmed, or on edge', points: { anxiety: 3, hormones: 1 } },
      { text: 'Low mood, irritability, or feeling emotionally flat', points: { anxiety: 2, hormones: 2 } },
    ],
  },
  {
    id: 5,
    question: 'How are your sleep patterns?',
    options: [
      { text: 'I fall asleep easily and wake refreshed', points: { fatigue: 0 } },
      { text: 'I have trouble falling asleep — my mind races', points: { anxiety: 2, hormones: 1 } },
      { text: 'I wake up at 2-4 AM and cannot fall back asleep', points: { hormones: 2, fatigue: 1 } },
      { text: 'I sleep 8+ hours but never feel rested', points: { fatigue: 3, thyroid: 2 } },
    ],
  },
  {
    id: 6,
    question: 'Do you experience any of the following hormone-related symptoms?',
    options: [
      { text: 'None of these apply to me', points: { hormones: 0 } },
      { text: 'Irregular or painful periods, PMS, or acne', points: { hormones: 3 } },
      { text: 'Hot flashes, night sweats, or low libido', points: { hormones: 3, fatigue: 1 } },
      { text: 'Hair thinning, dry skin, or feeling cold all the time', points: { thyroid: 3 } },
    ],
  },
  {
    id: 7,
    question: 'Have you been told your lab work is "normal" while still feeling unwell?',
    options: [
      { text: 'No — I have not had labs drawn recently', points: {} },
      { text: 'No — my labs showed clear issues that are being treated', points: {} },
      { text: 'Yes — once or twice', points: { thyroid: 1, autoimmune: 1 } },
      { text: 'Yes — multiple times, and nobody can explain my symptoms', points: { thyroid: 2, autoimmune: 2, hormones: 1 } },
    ],
  },
  {
    id: 8,
    question: 'Do you have a family history of autoimmune conditions (thyroid disease, lupus, RA, celiac, etc.)?',
    options: [
      { text: 'Not that I know of', points: { autoimmune: 0 } },
      { text: 'Yes — one family member', points: { autoimmune: 1 } },
      { text: 'Yes — multiple family members', points: { autoimmune: 2, thyroid: 1 } },
      { text: 'I have been diagnosed with an autoimmune condition myself', points: { autoimmune: 3, gut: 1 } },
    ],
  },
];

const results = {
  thyroid: {
    title: 'Thyroid & Hashimoto\'s',
    description: 'Your answers suggest thyroid function may be worth investigating. Standard labs often miss subclinical thyroid issues and Hashimoto\'s autoimmunity. A comprehensive thyroid panel — including antibodies, free T3, free T4, and reverse T3 — can reveal what basic TSH alone misses.',
    link: '/conditions',
    color: 'sage',
  },
  hormones: {
    title: 'Hormonal Imbalance',
    description: 'Your symptoms are consistent with hormonal imbalances — whether estrogen/progesterone ratios, cortisol rhythm disruption, or testosterone levels. DUTCH hormone testing maps your full 24-hour metabolite pattern, giving us a far more complete picture than a single blood draw.',
    link: '/conditions/hormonal-balance',
    color: 'terracotta',
  },
  gut: {
    title: 'Gut Health & Digestion',
    description: 'Your digestive symptoms point toward potential gut imbalances — SIBO, dysbiosis, leaky gut, or food sensitivities. A GI-MAP stool test can identify bacterial overgrowth, parasites, inflammation, and enzyme function in a single panel.',
    link: '/conditions/digestive-health',
    color: 'earth',
  },
  fatigue: {
    title: 'Chronic Fatigue & Energy',
    description: 'Persistent fatigue despite adequate sleep often has measurable, treatable root causes — from iron storage and B12 to adrenal function and mitochondrial health. We test beyond the basics to find out why your energy has been stolen.',
    link: '/conditions',
    color: 'sage',
  },
  anxiety: {
    title: 'Anxiety, Mood & Brain Fog',
    description: 'Mood issues often have biochemical drivers — nutrient deficiencies, gut-brain axis disruption, hormone imbalances, or inflammation. Rather than defaulting to medication, we investigate the root cause and address it at the source.',
    link: '/conditions/stress-anxiety',
    color: 'terracotta',
  },
  weight: {
    title: 'Weight Resistance',
    description: 'When the scale will not budge despite doing everything right, the issue is rarely willpower. Insulin resistance, thyroid dysfunction, cortisol imbalances, and inflammation can all block weight loss. We test for all of them.',
    link: '/conditions/weight-management',
    color: 'earth',
  },
  autoimmune: {
    title: 'Autoimmune Conditions',
    description: 'Your answers suggest autoimmune factors may be at play. Autoimmune conditions are often missed for years because symptoms overlap with other issues. We run targeted antibody panels and work to calm the immune system through gut healing, nutrition, and lifestyle medicine.',
    link: '/conditions',
    color: 'sage',
  },
};
---

<BaseLayout title="Health Quiz | Love Your Health Natural Medicine">

  <!-- ==================== 1. HERO ==================== -->
  <section class="relative overflow-hidden" style="background: linear-gradient(135deg, #EEF2EB 0%, #FDF6EE 50%, #F5E0D0 100%);">
    <div class="absolute top-0 right-1/4 w-[30rem] h-[30rem] rounded-full bg-white/40 blur-[120px] pointer-events-none" aria-hidden="true"></div>

    <div class="container-main section-padding relative z-10">
      <div class="text-center max-w-3xl mx-auto">
        <div class="hero-el inline-flex items-center gap-2 bg-white/70 backdrop-blur-sm border border-sage-pale/50 rounded-full px-4 py-1.5 mb-6">
          <svg class="w-3.5 h-3.5 text-sage" fill="none" stroke="currentColor" stroke-width="2" viewBox="0 0 24 24"><path d="M9 11l3 3L22 4"/><path d="M21 12v7a2 2 0 01-2 2H5a2 2 0 01-2-2V5a2 2 0 012-2h11"/></svg>
          <span class="text-xs font-semibold uppercase tracking-[0.2em] text-sage">2-Minute Health Quiz</span>
        </div>

        <h1 class="hero-el text-[clamp(2rem,5vw,3.5rem)] font-black leading-[1.05] tracking-[-0.03em] text-charcoal mb-5">
          What's your body <span class="text-sage">trying to tell you?</span>
        </h1>

        <p class="hero-el text-charcoal/70 text-base md:text-lg leading-relaxed max-w-xl mx-auto mb-8">
          Answer 8 quick questions about your symptoms. We'll show you which root-cause areas may need attention — and what to do next.
        </p>

        <div class="hero-el flex flex-wrap justify-center gap-3">
          <div class="flex items-center gap-2 bg-white/80 backdrop-blur-sm rounded-full px-4 py-2 border border-sage-pale/30">
            <svg class="w-3.5 h-3.5 text-sage" fill="none" stroke="currentColor" stroke-width="2" viewBox="0 0 24 24"><circle cx="12" cy="12" r="10"/><polyline points="12 6 12 12 16 14"/></svg>
            <span class="text-sm font-semibold text-charcoal">Takes 2 Minutes</span>
          </div>
          <div class="flex items-center gap-2 bg-white/80 backdrop-blur-sm rounded-full px-4 py-2 border border-sage-pale/30">
            <svg class="w-3.5 h-3.5 text-terracotta" fill="none" stroke="currentColor" stroke-width="2" viewBox="0 0 24 24"><path d="M12 22s8-4 8-10V5l-8-3-8 3v7c0 6 8 10 8 10z"/></svg>
            <span class="text-sm font-semibold text-charcoal">100% Private</span>
          </div>
          <div class="flex items-center gap-2 bg-white/80 backdrop-blur-sm rounded-full px-4 py-2 border border-sage-pale/30">
            <svg class="w-3.5 h-3.5 text-earth" fill="none" stroke="currentColor" stroke-width="2" viewBox="0 0 24 24"><path d="M14 2H6a2 2 0 00-2 2v16a2 2 0 002 2h12a2 2 0 002-2V8z"/><polyline points="14 2 14 8 20 8"/></svg>
            <span class="text-sm font-semibold text-charcoal">Personalized Results</span>
          </div>
        </div>
      </div>
    </div>
  </section>

  <!-- ==================== 2. QUIZ ==================== -->
  <section class="section-padding bg-white relative overflow-hidden" id="quiz-section">
    <div class="container-main">
      <div class="max-w-3xl mx-auto">

        <!-- Progress bar -->
        <div class="mb-10">
          <div class="flex items-center justify-between mb-2">
            <span class="text-xs font-semibold text-text-light" id="progress-label">Question 1 of 8</span>
            <span class="text-xs font-semibold text-sage" id="progress-percent">0%</span>
          </div>
          <div class="w-full h-2 bg-sage-pale/40 rounded-full overflow-hidden">
            <div class="h-full bg-sage rounded-full transition-all duration-500 ease-out" id="progress-bar" style="width: 0%;"></div>
          </div>
        </div>

        <!-- Question cards -->
        <div id="quiz-container">
          {questions.map((q, qIndex) => (
            <div
              class={`quiz-question ${qIndex === 0 ? '' : 'hidden'}`}
              data-question={qIndex}
            >
              <div class="mb-2">
                <span class="inline-flex items-center gap-2 text-xs font-semibold uppercase tracking-[0.2em] text-sage">
                  <span class="w-6 h-6 rounded-full bg-sage/10 flex items-center justify-center text-[10px] font-black text-sage">{String(q.id).padStart(2, '0')}</span>
                  Question {q.id}
                </span>
              </div>
              <h2 class="text-xl md:text-2xl font-black leading-[1.15] tracking-[-0.02em] text-charcoal mb-8">
                {q.question}
              </h2>

              <div class="space-y-3">
                {q.options.map((opt, optIndex) => (
                  <button
                    class="quiz-option w-full text-left bg-warm-white hover:bg-sage-pale/30 rounded-[1.25rem] p-5 border border-sage-pale/40 transition-all duration-300 hover:border-sage/40 hover:shadow-sm group cursor-pointer"
                    data-question={qIndex}
                    data-option={optIndex}
                    data-points={JSON.stringify(opt.points)}
                  >
                    <div class="flex items-center gap-4">
                      <div class="w-8 h-8 rounded-full border-2 border-sage-pale group-hover:border-sage flex items-center justify-center shrink-0 transition-colors">
                        <div class="w-3 h-3 rounded-full bg-transparent group-hover:bg-sage/20 transition-colors quiz-radio"></div>
                      </div>
                      <span class="text-sm md:text-base font-medium text-charcoal">{opt.text}</span>
                    </div>
                  </button>
                ))}
              </div>
            </div>
          ))}
        </div>

        <!-- Results (hidden initially) -->
        <div id="quiz-results" class="hidden">
          <div class="text-center mb-10">
            <div class="inline-flex items-center gap-2 bg-sage/10 rounded-full px-4 py-1.5 mb-5">
              <svg class="w-4 h-4 text-sage" fill="none" stroke="currentColor" stroke-width="2" viewBox="0 0 24 24"><path d="M22 11.08V12a10 10 0 11-5.93-9.14"/><polyline points="22 4 12 14.01 9 11.01"/></svg>
              <span class="text-xs font-semibold uppercase tracking-[0.2em] text-sage">Quiz Complete</span>
            </div>
            <h2 class="text-[clamp(1.5rem,3.5vw,2.25rem)] font-black leading-[1.1] tracking-[-0.02em] text-charcoal mb-3">
              Your <span class="text-sage">results</span> are in.
            </h2>
            <p class="text-text-light text-sm md:text-base leading-relaxed max-w-lg mx-auto">
              Based on your answers, here are the areas that may benefit from a root-cause investigation. This is not a diagnosis — it's a starting point.
            </p>
          </div>

          <div id="results-cards" class="space-y-4">
            <!-- Results cards are injected by JS -->
          </div>

          <!-- Disclaimer -->
          <div class="mt-8 bg-warm-white rounded-[1.25rem] p-5 border border-sage-pale/30">
            <div class="flex items-start gap-3">
              <svg class="w-5 h-5 text-text-light shrink-0 mt-0.5" fill="none" stroke="currentColor" stroke-width="1.5" viewBox="0 0 24 24"><circle cx="12" cy="12" r="10"/><path d="M12 16v-4M12 8h.01"/></svg>
              <p class="text-xs text-text-light leading-relaxed">
                <strong class="text-charcoal">Disclaimer:</strong> This quiz is for educational purposes only and does not constitute medical advice, diagnosis, or treatment. Your results highlight areas worth discussing with a qualified healthcare provider. For a thorough evaluation, schedule a consultation with our team.
              </p>
            </div>
          </div>
        </div>
      </div>
    </div>
  </section>

  <!-- ==================== 3. CTA (shown after results) ==================== -->
  <section class="section-padding bg-cream relative overflow-hidden" id="quiz-cta">
    <div class="absolute top-1/2 left-1/2 -translate-x-1/2 -translate-y-1/2 w-[50rem] h-[50rem] rounded-full bg-sage/5 blur-[140px] pointer-events-none" aria-hidden="true"></div>

    <div class="container-main relative z-10 text-center">
      <div class="max-w-2xl mx-auto">
        <h2 class="text-[clamp(1.5rem,3.5vw,2.25rem)] font-black leading-[1.1] tracking-[-0.02em] text-charcoal mb-4">
          Ready to find your <span class="text-sage">root cause?</span>
        </h2>
        <p class="text-text-light text-sm md:text-base leading-relaxed mb-8 max-w-lg mx-auto">
          A quiz is a great starting point. But real answers come from advanced testing and a doctor who listens. Book your 75-90 minute first visit.
        </p>
        <div class="flex flex-col sm:flex-row items-center justify-center gap-3">
          <a href="https://loveyourhealthnaturalmedicine.com" target="_blank" rel="noopener noreferrer" class="magnetic-btn cta-shine inline-flex items-center justify-center gap-2 bg-sage hover:bg-sage-dark text-white font-semibold text-sm px-7 py-3.5 rounded-full transition-all duration-300 shadow-lg shadow-sage/20 hover:shadow-xl hover:shadow-sage/30 w-full sm:w-auto">
            Book a Consultation
          </a>
          <a href="tel:4809140521" class="magnetic-btn inline-flex items-center justify-center gap-2 bg-white hover:bg-sage-pale/30 text-charcoal font-semibold text-sm px-7 py-3.5 rounded-full border border-sage-pale/50 transition-all duration-300 w-full sm:w-auto">
            <svg class="w-4 h-4 text-sage" fill="none" stroke="currentColor" stroke-width="2" viewBox="0 0 24 24"><path d="M22 16.92v3a2 2 0 01-2.18 2 19.79 19.79 0 01-8.63-3.07 19.5 19.5 0 01-6-6 19.79 19.79 0 01-3.07-8.67A2 2 0 014.11 2h3a2 2 0 012 1.72c.127.96.361 1.903.7 2.81a2 2 0 01-.45 2.11L8.09 9.91a16 16 0 006 6l1.27-1.27a2 2 0 012.11-.45c.907.339 1.85.573 2.81.7A2 2 0 0122 16.92z"/></svg>
            Call (480) 914-0521
          </a>
        </div>
      </div>
    </div>
  </section>

</BaseLayout>

<style>
  /* ===== HERO STAGGER ===== */
  .hero-el {
    opacity: 0;
    transform: translateY(20px);
    animation: heroFade 0.7s cubic-bezier(0.22, 1, 0.36, 1) forwards;
  }
  .hero-el:nth-child(1) { animation-delay: 0.1s; }
  .hero-el:nth-child(2) { animation-delay: 0.2s; }
  .hero-el:nth-child(3) { animation-delay: 0.3s; }
  .hero-el:nth-child(4) { animation-delay: 0.4s; }
  @keyframes heroFade {
    to { opacity: 1; transform: translateY(0); }
  }

  /* ===== QUIZ OPTION SELECTED ===== */
  .quiz-option.selected {
    background-color: #E2EDE7;
    border-color: #5B8C6F;
  }
  .quiz-option.selected .quiz-radio {
    background-color: #5B8C6F;
  }

  /* ===== QUESTION TRANSITIONS ===== */
  .quiz-question {
    animation: questionIn 0.4s cubic-bezier(0.22, 1, 0.36, 1);
  }
  @keyframes questionIn {
    from { opacity: 0; transform: translateX(30px); }
    to { opacity: 1; transform: translateX(0); }
  }

  /* ===== RESULT CARD ===== */
  .result-card {
    animation: resultIn 0.5s cubic-bezier(0.22, 1, 0.36, 1) both;
  }
  .result-card:nth-child(1) { animation-delay: 0.1s; }
  .result-card:nth-child(2) { animation-delay: 0.2s; }
  .result-card:nth-child(3) { animation-delay: 0.3s; }
  @keyframes resultIn {
    from { opacity: 0; transform: translateY(20px); }
    to { opacity: 1; transform: translateY(0); }
  }

  /* ===== CTA SHINE ===== */
  .cta-shine {
    position: relative;
    overflow: hidden;
  }
  .cta-shine::after {
    content: '';
    position: absolute;
    top: 0; left: -100%; width: 50%; height: 100%;
    background: linear-gradient(90deg, transparent, rgba(255,255,255,0.15), transparent);
    transition: left 0.5s ease;
  }
  .cta-shine:hover::after {
    left: 100%;
  }

  /* ===== SCORE BAR ===== */
  .score-bar {
    transition: width 0.8s cubic-bezier(0.22, 1, 0.36, 1) 0.3s;
  }

  /* ===== REDUCED MOTION ===== */
  @media (prefers-reduced-motion: reduce) {
    .hero-el {
      opacity: 1;
      transform: none;
      animation: none;
    }
    .quiz-question {
      animation: none;
    }
    .result-card {
      animation: none;
      opacity: 1;
      transform: none;
    }
    .score-bar {
      transition: none;
    }
    .cta-shine::after {
      display: none;
    }
  }
</style>

<script>
  // ===== QUIZ STATE =====
  const scores: Record<string, number> = {
    thyroid: 0,
    hormones: 0,
    gut: 0,
    fatigue: 0,
    anxiety: 0,
    weight: 0,
    autoimmune: 0,
  };

  let currentQuestion = 0;
  const totalQuestions = 8;

  const results: Record<string, { title: string; description: string; link: string; color: string }> = {
    thyroid: {
      title: 'Thyroid & Hashimoto\'s',
      description: 'Your answers suggest thyroid function may be worth investigating. Standard labs often miss subclinical thyroid issues and Hashimoto\'s autoimmunity. A comprehensive thyroid panel can reveal what basic TSH alone misses.',
      link: '/conditions',
      color: 'sage',
    },
    hormones: {
      title: 'Hormonal Imbalance',
      description: 'Your symptoms are consistent with hormonal imbalances. DUTCH hormone testing maps your full 24-hour metabolite pattern, giving a far more complete picture than a single blood draw.',
      link: '/conditions/hormonal-balance',
      color: 'terracotta',
    },
    gut: {
      title: 'Gut Health & Digestion',
      description: 'Your digestive symptoms point toward potential gut imbalances — SIBO, dysbiosis, or food sensitivities. A GI-MAP stool test can identify the root cause in a single panel.',
      link: '/conditions/digestive-health',
      color: 'earth',
    },
    fatigue: {
      title: 'Chronic Fatigue & Energy',
      description: 'Persistent fatigue often has measurable root causes — from iron storage and B12 to adrenal function. We test beyond the basics to find out why your energy has been stolen.',
      link: '/conditions',
      color: 'sage',
    },
    anxiety: {
      title: 'Anxiety, Mood & Brain Fog',
      description: 'Mood issues often have biochemical drivers — nutrient deficiencies, gut-brain axis disruption, or inflammation. We investigate the root cause rather than defaulting to medication.',
      link: '/conditions/stress-anxiety',
      color: 'terracotta',
    },
    weight: {
      title: 'Weight Resistance',
      description: 'When the scale will not budge, insulin resistance, thyroid dysfunction, and cortisol imbalances may be blocking progress. We test for all of them.',
      link: '/conditions/weight-management',
      color: 'earth',
    },
    autoimmune: {
      title: 'Autoimmune Conditions',
      description: 'Your answers suggest autoimmune factors may be at play. We run targeted antibody panels and work to calm the immune system through gut healing, nutrition, and lifestyle medicine.',
      link: '/conditions',
      color: 'sage',
    },
  };

  const colorConfig: Record<string, { bg: string; border: string; bar: string; text: string }> = {
    sage: { bg: '#E2EDE7', border: '#5B8C6F', bar: '#5B8C6F', text: '#3E6B52' },
    terracotta: { bg: '#F5E0D0', border: '#C47D5A', bar: '#C47D5A', text: '#C47D5A' },
    earth: { bg: '#F5E0D0', border: '#8B7355', bar: '#8B7355', text: '#8B7355' },
  };

  function updateProgress() {
    const pct = Math.round((currentQuestion / totalQuestions) * 100);
    const bar = document.getElementById('progress-bar');
    const label = document.getElementById('progress-label');
    const percent = document.getElementById('progress-percent');
    if (bar) bar.style.width = pct + '%';
    if (label) label.textContent = currentQuestion < totalQuestions
      ? `Question ${currentQuestion + 1} of ${totalQuestions}`
      : 'Complete!';
    if (percent) percent.textContent = pct + '%';
  }

  function showQuestion(index: number) {
    document.querySelectorAll('.quiz-question').forEach((el) => {
      el.classList.add('hidden');
    });
    const next = document.querySelector(`[data-question="${index}"]`) as HTMLElement;
    if (next) {
      next.classList.remove('hidden');
    }
  }

  function showResults() {
    // Hide quiz container, show results
    const container = document.getElementById('quiz-container');
    const resultsEl = document.getElementById('quiz-results');
    const progressBar = container?.previousElementSibling;
    if (container) container.classList.add('hidden');
    if (progressBar) (progressBar as HTMLElement).classList.add('hidden');
    if (resultsEl) resultsEl.classList.remove('hidden');

    // Sort scores and get top results (score > 0)
    const sorted = Object.entries(scores)
      .filter(([, v]) => v > 0)
      .sort((a, b) => b[1] - a[1])
      .slice(0, 3);

    const maxScore = Math.max(...Object.values(scores), 1);
    const cardsContainer = document.getElementById('results-cards');
    if (!cardsContainer) return;

    if (sorted.length === 0) {
      cardsContainer.innerHTML = `
        <div class="bg-sage-pale/30 rounded-[1.5rem] p-8 border border-sage-pale/40 text-center">
          <div class="w-12 h-12 rounded-2xl bg-sage/10 flex items-center justify-center mx-auto mb-4">
            <svg class="w-6 h-6 text-sage" fill="none" stroke="currentColor" stroke-width="1.5" viewBox="0 0 24 24"><path d="M22 11.08V12a10 10 0 11-5.93-9.14"/><polyline points="22 4 12 14.01 9 11.01"/></svg>
          </div>
          <h3 class="text-lg font-black text-charcoal mb-2">Looking good!</h3>
          <p class="text-sm text-text-light leading-relaxed max-w-md mx-auto">
            Your answers don't flag any major areas of concern right now. If you're still experiencing symptoms, a consultation can uncover subtleties a quiz cannot.
          </p>
        </div>
      `;
      return;
    }

    cardsContainer.innerHTML = sorted.map(([key, score], i) => {
      const r = results[key];
      const c = colorConfig[r.color];
      const pct = Math.round((score / maxScore) * 100);
      const rank = i === 0 ? 'Primary Area' : i === 1 ? 'Secondary Area' : 'Worth Investigating';
      return `
        <div class="result-card bg-white rounded-[1.5rem] border shadow-sm overflow-hidden" style="border-color: ${c.border}30;">
          <div class="h-1.5" style="background-color: ${c.bar};"></div>
          <div class="p-6 md:p-8">
            <div class="flex items-start justify-between gap-4 mb-4">
              <div>
                <span class="inline-block text-xs font-semibold uppercase tracking-[0.15em] px-2.5 py-1 rounded-full mb-2" style="background-color: ${c.bg}; color: ${c.text};">${rank}</span>
                <h3 class="text-lg md:text-xl font-black text-charcoal">${r.title}</h3>
              </div>
              <div class="text-right shrink-0">
                <span class="text-2xl font-black" style="color: ${c.text};">${pct}%</span>
                <p class="text-[10px] text-text-light">match</p>
              </div>
            </div>
            <div class="w-full h-2 rounded-full mb-4" style="background-color: ${c.bg};">
              <div class="score-bar h-full rounded-full" style="background-color: ${c.bar}; width: ${pct}%;"></div>
            </div>
            <p class="text-sm text-text-light leading-relaxed mb-4">${r.description}</p>
            <a href="${r.link}" class="inline-flex items-center gap-2 text-sm font-semibold transition-colors" style="color: ${c.text};">
              Learn more
              <svg class="w-4 h-4" fill="none" stroke="currentColor" stroke-width="2" viewBox="0 0 24 24"><path d="M5 12h14M12 5l7 7-7 7"/></svg>
            </a>
          </div>
        </div>
      `;
    }).join('');

    // Scroll to results
    resultsEl?.scrollIntoView({ behavior: 'smooth', block: 'start' });
  }

  // ===== OPTION CLICK HANDLERS =====
  document.querySelectorAll('.quiz-option').forEach((btn) => {
    btn.addEventListener('click', () => {
      const qIndex = parseInt(btn.getAttribute('data-question') || '0');
      const points = JSON.parse(btn.getAttribute('data-points') || '{}');

      // Mark selected
      document.querySelectorAll(`.quiz-option[data-question="${qIndex}"]`).forEach((opt) => {
        opt.classList.remove('selected');
      });
      btn.classList.add('selected');

      // Add points
      for (const [key, val] of Object.entries(points)) {
        scores[key] = (scores[key] || 0) + (val as number);
      }

      // Advance after short delay
      setTimeout(() => {
        currentQuestion++;
        updateProgress();

        if (currentQuestion >= totalQuestions) {
          showResults();
        } else {
          showQuestion(currentQuestion);
        }
      }, 400);
    });
  });

  // ===== MAGNETIC BUTTONS =====
  if (!window.matchMedia('(prefers-reduced-motion: reduce)').matches) {
    document.querySelectorAll('.magnetic-btn').forEach((btn) => {
      btn.addEventListener('mousemove', (e: MouseEvent) => {
        const rect = (btn as HTMLElement).getBoundingClientRect();
        const x = e.clientX - rect.left - rect.width / 2;
        const y = e.clientY - rect.top - rect.height / 2;
        (btn as HTMLElement).style.transform = `translate(${x * 0.15}px, ${y * 0.15}px)`;
      });
      btn.addEventListener('mouseleave', () => {
        (btn as HTMLElement).style.transform = '';
      });
    });
  }

  // Init
  updateProgress();
</script>
